---
title: "DArT_Report2VCF_par"
output: html_document
date: "2024-08-29"
---

* **DArT MADC File**

The DArT MADC (Missing Allele Discovery Counts) file is a comma-separated file provided by DArT from a sequencing project. It includes the following key columns:

* AlleleID: Typically contains the chromosome, position, reference or alternative allele designation, and the allele ID according to the haplotype database (e.g., `Chr01_000084128|Ref_0001`).
* CloneID: Represents the chromosome and position (e.g., `Chr01_000084128`).
*	AlleleSequence: The amplicon sequence (e.g., `GAGTGTGAAGATTTGGACAAAAGAGGTTGGTTTTTACTGTTATGGCATTTATCTCCTTATAAAATTTTGTATTTTTTTTGT`).
*	Sample Columns: Named with sample IDs and containing counts of each allele per sample.

**Important**: BIGapp requires fixed AlleleIDs tagged with a respective number (e.g., suffix: `_0001`). Fixed AlleleIDs are generated by matching the MADC contents to the haplotype database. If your MADC file does not contain fixed AlleleIDs, please contact Breeding Insight.


* **Target vs. Off-Target SNPs**

If you provide a MADC file, you can choose between extracting:

* Only **target SNPs** – These are the SNPs for which probes were specifically designed. If your panel includes 3,000 SNPs, your output VCF file should contain exactly 3,000 target SNPs.
* Both **target** and **off-target** SNPs – In addition to target SNPs, BIGapp will identify other SNPs within the amplicon region.

* **Target SNPs**

If you decide to extract only the **target SNPs**, you can choose if reference (REF) and alternative (ALT) bases should also be extracted. For extracting this information from the MADC file, BIGapp compares the reference sequences with the alternative, finds the polymorphic site and notate the changing base. This requires:

  - Reference (`Ref_0001`) and alternative (`Alt_0002`) sequences for each tag. If one or both is missing, the tag will be discarded.
  - A single polymorphism between them. If more than one is found, the tag is discarded
  - A `.botloci` file to inform which tag sequences should be converted to its reverse complement. For BI-supported marker panel **species** this file is already embedded within the app, no upload is required.

If you choose to not extract REF and ALT information, all tags will be kept, but your VCF will have missing data (`.`) in the REF and ALT fields. The only process in BIGapp that will require this information is the Dosage Calling with PolyRAD.

* **Target and off-target (all) SNPs**

To identify **off-target** SNPs, BIGapp aligns each amplicon against its reference (via Bioconductor’s `Biostrings` + `pwalign`) to uncover additional polymorphisms. This procedure requires:

  - Reference & alternative sequences (e.g. `Ref_0001`, `Alt_0002`) for every tag  
    - If a FASTA haplotype database is supplied, any missing sequences in the MADC file will be retrieved automatically.  
    - Without a FASTA database, tags lacking either sequence are discarded.  
  - Exactly one polymorphic site  
    - Tags with zero or multiple variants are excluded.  
  - `.botloci` file
    - Specifies which tags must be reverse-complemented. For BI-supported species, this file is bundled within the app—no upload needed.

* **Specie**

Specify the species so BIGapp can pick the correct `.botloci` file. BI-supported species files live in the [BIGapp-PanelHub](https://github.com/Breeding-Insight/BIGapp-PanelHub) repo and are auto-loaded by the app.

You can also input **multiple MADC files**. BIGapp will merge the files before the conversion. If you have repeated samples IDs, a suffix with the run ID (beginning of the file name) will be added to the repeated samples.

Conversion is powered by the `madc2vcf_targets` and `madc2vcf_all` functions in the [BIGr](https://github.com/Breeding-Insight/BIGr) R package. You can also run them on the command line to access advanced options (e.g., multiallelic SNP support or custom alignment thresholds).

* **DArTag Dosage Report**

The DArT Dosage Report is a tab-separated file provided by DArT from a sequencing project. It contains genotypic information for each target marker across all samples in the sequencing project.

File Structure:

* Markers are in rows, and samples are in columns.
* The file includes several summary metric columns before the sample dosage columns.
* Dosage values represent the number of alternative alleles present in each sample, ranging from 0 to the species’ ploidy number.

Dosage Interpretation (Example: Tetraploid Species - 4x)

* 4 → Homozygous for the reference allele (AAAA)
*	3 → Heterozygous with three reference alleles and one alternative (AAAB)
*	2 → Heterozygous with two reference and two alternative alleles (AABB)
*	1 → Heterozygous with one reference allele and three alternative (ABBB)
*	0 → Homozygous for the alternative allele (BBBB)

This codification is commonly used as input for various software, including AGHmatrix, rrBLUP, and mappoly. However, some programs require not only dosage information but also read counts (see description below).

To accommodate this, BIGapp integrates both dosage and read count data, generating a VCF file—the most widely accepted and standardized format for genotypic information, ensuring compatibility with a broad range of software.

 
* **DArTag Counts File**

The DArT counts file is a tab-separated file provided by DArT from a sequencing project. It contains the read count information for the reference and alternate allele at each target marker. The marker information is in the rows and the samples are in the columns. There are several informational columns that precede the sample columns. There are two versions of this file. The “collapsed counts” version contains the target markers that includes their multiallic read counts in their total counts. The “Counts” file contains the read counts for the target markers only (excluding the multiallelic read count information). BIGapp will merge the counts and the dosage information to generate a VCF file format —the most widely accepted and standardized format for genotypic information, ensuring compatibility with a broad range of software.
 
* **Species Ploidy**

Specifies the ploidy level of the species. The current analysis supports both diploids and autopolyploids. 
